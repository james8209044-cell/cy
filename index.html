<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Packing List Generator</title>
    <!-- å¼•å…¥ SheetJS ç”¨ä¾†ç”¢å‡º Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 20px auto; padding: 20px; background-color: #f4f4f4; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h3 { color: #333; text-align: center; }
        .section { margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; }
        .row { display: flex; gap: 20px; margin-bottom: 10px; }
        .col { flex: 1; }
        label { display: block; font-weight: bold; margin-bottom: 5px; }
        input { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 4px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        th { background-color: #f8f9fa; }
        
        button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 4px; font-size: 14px; }
        .btn-add { background-color: #28a745; color: white; margin-top: 10px; }
        .btn-del { background-color: #dc3545; color: white; padding: 5px 10px; }
        .btn-gen { background-color: #007bff; color: white; display: block; width: 100%; font-size: 18px; margin-top: 30px; padding: 15px; }
        .btn-gen:hover { background-color: #0056b3; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ Packing List ç”¢ç”Ÿå™¨</h1>

    <!-- 1. è³£æ–¹è³‡è¨Š -->
    <div class="section">
        <h3>è³£æ–¹è³‡æ–™ (Shipper)</h3>
        <div class="row">
            <div class="col"><label>å…¬å¸åç¨±</label><input type="text" id="sellerName" value="MY TRADING CO., LTD."></div>
        </div>
        <div class="row">
            <div class="col"><label>åœ°å€</label><input type="text" id="sellerAddr" value="Taipei, Taiwan"></div>
            <div class="col"><label>é›»è©±</label><input type="text" id="sellerTel" value="+886-2-1234-5678"></div>
        </div>
    </div>

    <!-- 2. å‡ºè²¨å–®æ“šè³‡è¨Š -->
    <div class="section">
        <h3>å–®æ“šè³‡è¨Š (Info)</h3>
        <div class="row">
            <div class="col"><label>Invoice No.</label><input type="text" id="invoiceNo" placeholder="e.g. INV-2023001"></div>
            <div class="col"><label>Date</label><input type="date" id="date"></div>
        </div>
        <div class="row">
            <div class="col"><label>From (Port)</label><input type="text" id="fromPort" value="Taiwan"></div>
            <div class="col"><label>To (Port)</label><input type="text" id="toPort" value="Japan"></div>
        </div>
    </div>

    <!-- 3. è²·æ–¹è³‡è¨Š -->
    <div class="section">
        <h3>æ”¶ä»¶äºº (Consignee)</h3>
        <div class="col"><label>å…¬å¸åç¨±/åœ°å€</label><input type="text" id="buyerInfo" placeholder="è¼¸å…¥å®¢æˆ¶åç¨±èˆ‡åœ°å€"></div>
    </div>

    <!-- 4. è²¨ç‰©æ¸…å–® -->
    <div class="section">
        <h3>è²¨ç‰©æ¸…å–® (Items)</h3>
        <table>
            <thead>
                <tr>
                    <th width="10%">ç®±è™Ÿ</th>
                    <th width="35%">å“å</th>
                    <th width="15%">æ•¸é‡</th>
                    <th width="10%">å–®ä½</th>
                    <th width="10%">N.W (kg)</th>
                    <th width="10%">G.W (kg)</th>
                    <th width="5%">æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="itemBody">
                <!-- é è¨­ä¸€è¡Œ -->
                <tr>
                    <td><input type="text" value="1-5"></td>
                    <td><input type="text" value="Item A"></td>
                    <td><input type="number" value="100"></td>
                    <td><input type="text" value="PCS"></td>
                    <td><input type="number" value="50"></td>
                    <td><input type="number" value="55"></td>
                    <td><button class="btn-del" onclick="removeRow(this)">X</button></td>
                </tr>
            </tbody>
        </table>
        <button class="btn-add" onclick="addRow()">+ æ–°å¢é …ç›®</button>
    </div>

    <!-- ç”¢ç”ŸæŒ‰éˆ• -->
    <button class="btn-gen" onclick="generateExcel()">ğŸ“¥ ç”¢ç”Ÿä¸¦ä¸‹è¼‰ Excel</button>
</div>

<script>
    // è¨­å®šé è¨­æ—¥æœŸç‚ºä»Šå¤©
    document.getElementById('date').valueAsDate = new Date();

    // æ–°å¢ä¸€åˆ—
    function addRow() {
        const tbody = document.getElementById('itemBody');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><input type="text"></td>
            <td><input type="text"></td>
            <td><input type="number"></td>
            <td><input type="text" value="PCS"></td>
            <td><input type="number"></td>
            <td><input type="number"></td>
            <td><button class="btn-del" onclick="removeRow(this)">X</button></td>
        `;
        tbody.appendChild(row);
    }

    // åˆªé™¤ä¸€åˆ—
    function removeRow(btn) {
        const row = btn.parentNode.parentNode;
        row.parentNode.removeChild(row);
    }

    // ç”¢ç”Ÿ Excel çš„æ ¸å¿ƒé‚è¼¯
    function generateExcel() {
        // 1. ç²å–è¡¨å–®è³‡æ–™
        const sellerName = document.getElementById('sellerName').value;
        const sellerAddr = document.getElementById('sellerAddr').value;
        const sellerTel = document.getElementById('sellerTel').value;
        
        const invoiceNo = document.getElementById('invoiceNo').value || 'DRAFT';
        const date = document.getElementById('date').value;
        const fromPort = document.getElementById('fromPort').value;
        const toPort = document.getElementById('toPort').value;
        const buyerInfo = document.getElementById('buyerInfo').value;

        // 2. æº–å‚™ Excel çš„è³‡æ–™é™£åˆ— (Array of Arrays)
        // é€™æ˜¯è¨­è¨ˆ Excel ç‰ˆé¢çš„åœ°æ–¹ï¼Œæ¯ä¸€è¡Œä»£ç¢¼ä»£è¡¨ Excel çš„ä¸€åˆ—
        let data = [
            [sellerName], // A1
            [sellerAddr], // A2
            [`Tel: ${sellerTel}`], // A3
            [], // ç©ºè¡Œ
            ["PACKING LIST"], // A5 æ¨™é¡Œ
            [],
            ["TO:", buyerInfo, "", "Invoice No:", invoiceNo],
            ["", "", "", "Date:", date],
            ["", "", "", "From:", fromPort],
            ["", "", "", "To:", toPort],
            [],
            ["Carton No", "Description", "Quantity", "Unit", "N.W (kg)", "G.W (kg)"] // è¡¨é ­
        ];

        // 3. æŠ“å–è¡¨æ ¼å…§çš„è³‡æ–™
        const rows = document.querySelectorAll('#itemBody tr');
        let totalQty = 0;
        let totalNW = 0;
        let totalGW = 0;

        rows.forEach(row => {
            const inputs = row.querySelectorAll('input');
            const qty = parseFloat(inputs[2].value) || 0;
            const nw = parseFloat(inputs[4].value) || 0;
            const gw = parseFloat(inputs[5].value) || 0;

            totalQty += qty;
            totalNW += nw;
            totalGW += gw;

            data.push([
                inputs[0].value, // Carton
                inputs[1].value, // Desc
                qty,             // Qty (ä¿æŒæ•¸å­—æ ¼å¼ä»¥ä¾¿ Excel è¨ˆç®—)
                inputs[3].value, // Unit
                nw,              // NW
                gw               // GW
            ]);
        });

        // 4. åŠ å…¥ç¸½è¨ˆè¡Œ
        data.push(["", "TOTAL:", totalQty, "", totalNW, totalGW]);

        // 5. å»ºç«‹ WorkBook ä¸¦åŒ¯å‡º
        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);

        // --- ç°¡å–®çš„æ¬„å¯¬è¨­å®š ---
        ws['!cols'] = [
            { wch: 15 }, // A Carton
            { wch: 30 }, // B Desc
            { wch: 10 }, // C Qty
            { wch: 10 }, // D Unit
            { wch: 12 }, // E NW
            { wch: 12 }  // F GW
        ];

        // åˆä½µå„²å­˜æ ¼ (æ¨™é¡Œç½®ä¸­ç­‰) - ç°¡å–®è¨­å®š
        // s: start (r: row, c: col), e: end
        ws['!merges'] = [
            { s: {r:0, c:0}, e: {r:0, c:5} }, // å…¬å¸åè·¨æ¬„
            { s: {r:1, c:0}, e: {r:1, c:5} }, // åœ°å€è·¨æ¬„
            { s: {r:2, c:0}, e: {r:2, c:5} }, // é›»è©±è·¨æ¬„
            { s: {r:4, c:0}, e: {r:4, c:5} }  // Packing List æ¨™é¡Œè·¨æ¬„
        ];

        XLSX.utils.book_append_sheet(wb, ws, "PackingList");
        
        // ä¸‹è¼‰æª”æ¡ˆ
        XLSX.writeFile(wb, `PackingList_${invoiceNo}.xlsx`);
    }
</script>

</body>
</html>